{% for wp in tree %}
<div class="mb-4" data-id="{{ wp.id }}">
    <!-- WP Node -->
    <div class="flex items-center gap-2 py-1 cursor-pointer hover:bg-orchay-card rounded px-2"
         hx-get="/api/tree/{{ wp.id }}"
         hx-target="#wp-children-{{ wp.id }}"
         hx-swap="innerHTML"
         onclick="this.querySelector('.toggle-icon').classList.toggle('rotate-90')">
        <span class="toggle-icon transition-transform">▶</span>
        <span class="text-orchay-accent font-medium">WP</span>
        <span class="font-bold">{{ wp.id }}</span>
        <span class="ml-auto text-sm text-orchay-muted">({{ wp.progress | round(0) | int }}%)</span>
    </div>

    <!-- WP Children Container -->
    <div id="wp-children-{{ wp.id }}" class="ml-4">
        {% for child in wp.children %}
        {% if child.type == 'act' %}
        <!-- ACT Node -->
        <div class="mb-2">
            <div class="flex items-center gap-2 py-1 cursor-pointer hover:bg-orchay-card rounded px-2">
                <span class="text-green-400 font-medium">A</span>
                <span class="font-medium">{{ child.id }}</span>
                <span class="ml-auto text-sm text-orchay-muted">({{ child.progress | round(0) | int }}%)</span>
            </div>

            <!-- Task Nodes under ACT -->
            {% for task in child.children %}
            <div class="ml-4 flex items-center gap-2 py-1 cursor-pointer hover:bg-orchay-card rounded px-2"
                 hx-get="/api/detail/{{ task.id }}"
                 hx-target="#detail-panel"
                 hx-swap="innerHTML">
                <span class="text-yellow-400 font-medium">T</span>
                <span>{{ task.id }}</span>
                <span class="ml-auto text-sm
                    {% if task.status == '[xx]' %}text-green-400
                    {% elif task.status == '[im]' %}text-blue-400
                    {% elif task.status == '[ap]' %}text-purple-400
                    {% elif task.status == '[dd]' %}text-yellow-400
                    {% elif task.status == '[bd]' %}text-orange-400
                    {% else %}text-orchay-muted{% endif %}">
                    {{ task.status }}
                </span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Direct Task Node (3-level) -->
        <div class="flex items-center gap-2 py-1 cursor-pointer hover:bg-orchay-card rounded px-2"
             hx-get="/api/detail/{{ child.id }}"
             hx-target="#detail-panel"
             hx-swap="innerHTML">
            <span class="text-yellow-400 font-medium">T</span>
            <span>{{ child.id }}</span>
            <span class="ml-auto text-sm
                {% if child.status == '[xx]' %}text-green-400
                {% elif child.status == '[im]' %}text-blue-400
                {% elif child.status == '[ap]' %}text-purple-400
                {% elif child.status == '[dd]' %}text-yellow-400
                {% elif child.status == '[bd]' %}text-orange-400
                {% else %}text-orchay-muted{% endif %}">
                {{ child.status }}
            </span>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>
{% endfor %}

{% if not tree %}
<div class="text-orchay-muted text-sm">Task가 없습니다</div>
{% endif %}
