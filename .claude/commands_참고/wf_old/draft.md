---
name: wf:draft
description: "development Task 상세설계 시작. 기본설계 → 상세설계 전환"
category: workflow
allowed-tools: [Read, Write, Edit, Glob, Grep, Bash, Task]
mcp-servers: [sequential-thinking, context7]
hierarchy-input: true
parallel-processing: true
---

# /wf:draft - 상세설계 시작

> **상태 전환**: `[bd] 기본설계` → `[dd] 상세설계`
> **적용 category**: development only
>
> **계층 입력 지원**: Work Package, Activity, Task 단위 입력 가능 (WP/ACT 입력 시 하위 Task 병렬 처리)

---

## ⛔ 코드 작성 금지 원칙 (최우선)

> **이 명령어는 개념적 설계 문서만 생성합니다. 프로그램 코드는 `/wf:build`에서 작성합니다.**

### 절대 금지 항목
| 금지 코드 유형 | 대체 방법 |
|---------------|----------|
| ❌ TypeScript/JavaScript 코드 블록 | ✅ 메서드 시그니처 표 (이름, 파라미터, 반환값) |
| ❌ Vue/React 컴포넌트 코드 | ✅ 컴포넌트 Props/Events 표 |
| ❌ API 핸들러 코드 | ✅ 엔드포인트 명세 표 (Method, Path, Request, Response) |
| ❌ SQL 쿼리 | ✅ 필드 목록 표 + ERD 다이어그램 |
| ❌ 테스트 코드 (describe, it, test) | ✅ 테스트 시나리오 표 (ID, 시나리오, 예상 결과) |
| ❌ 인터페이스/타입 정의 코드 | ✅ 필드 정의 표 (필드명, 타입, 필수여부, 설명) |
| ❌ 유효성 검증 코드 | ✅ 유효성 규칙 표 (필드, 규칙, 에러메시지) |

### 유일한 예외: DB 스키마 코드
| 허용 | 이유 |
|-----|------|
| ✅ **Prisma 스키마** | 구현 기초가 되는 데이터 모델 정의 |
| ✅ **ERD (Mermaid)** | 엔티티 관계 시각화 |

### 설계 표현 원칙
```
모든 설계는 다음 형식으로 표현:
├── 📊 표 (Table) - 필드 정의, 메서드 목록, API 명세
├── 📐 다이어그램 (Mermaid) - ERD, 시퀀스, 상태 전환
├── 🌳 트리 구조 (Text) - 디렉토리, 컴포넌트 계층
├── 📝 텍스트 설명 - 로직 설명, 비즈니스 규칙
└── 🎨 Text Art - 화면 레이아웃 와이어프레임
```

## 개념 충돌 해결

@.claude/includes/wf-conflict-resolution.md

---

## 사용법

```bash
/wf:draft [WP-ID | ACT-ID | Task-ID]

# Task 단위 (기존)
/wf:draft TSK-01-01-01

# Activity 단위 (ACT 내 모든 기본설계 완료 Task 병렬 처리)
/wf:draft ACT-01-01

# Work Package 단위 (WP 내 모든 기본설계 완료 Task 병렬 처리)
/wf:draft WP-01
```

## 계층 입력 처리

@.claude/includes/wf-hierarchy-input.md

### 입력 타입별 처리

| 입력 | 처리 방식 | 상태 필터 |
|------|----------|----------|
| `TSK-XX-XX-XX` | 단일 Task 처리 | `[bd]` 기본설계 |
| `ACT-XX-XX` | ACT 내 모든 Task 병렬 처리 | `[bd]` 기본설계 |
| `WP-XX` | WP 내 모든 Task 병렬 처리 | `[bd]` 기본설계 |

## 상태 전환 규칙

| category | 현재 상태 | 다음 상태 | 생성 문서 |
|----------|----------|----------|----------|
| development | `[bd]` 기본설계 | `[dd]` 상세설계 | `020-detail-design.md`, `025-traceability-matrix.md`, `026-test-specification.md` |

---

## 문서 경로

@.claude/includes/wf-common.md

**Task 폴더**: `.jjiban/projects/{project}/tasks/{TSK-ID}/`

---

## 문서 계층 구조

상세설계 시 다음 계층 구조를 따라 상위 문서를 참조합니다:

```
📁 .jjiban/                                    ← JJIBAN 데이터 루트
└── 📁 {project}/                              ← 프로젝트 폴더
    ├── 📄 project.json                        ← 프로젝트 메타데이터
    ├── 📄 team.json                           ← 팀 멤버 정보
    ├── 📄 index.json                          ← 칸반 인덱스 (자동 생성)
    ├── 📄 prd.md                              ← 프로젝트 PRD (전체 요구사항)
    ├── 📄 trd.md                              ← 프로젝트 TRD (기술 요구사항)
    │
    └── 📁 wbs/                                ← WBS 계층 구조
        └── 📁 {WP-ID}/                        ← Work Package
            ├── 📄 meta.json                   ← WP 메타데이터
            └── 📁 {ACT-ID}/                   ← Activity
                ├── 📄 meta.json               ← ACT 메타데이터
                └── 📁 {TSK-ID}/               ← Task 폴더 (데이터 + 문서)
                    ├── 📄 task.json           ← Task 데이터
                    ├── 📄 010-basic-design.md ← 기본설계 (입력)
                    ├── 📄 011-ui-design.md    ← 화면설계 (선택적 입력, /wf:ui 생성)
                    ├── 📁 ui-assets/          ← SVG 화면 파일 (선택적, /wf:ui 생성)
                    │   └── 📄 screen-*.svg    ← 화면별 SVG 파일
                    ├── 📄 020-detail-design.md       ← 상세설계 (출력)
                    ├── 📄 025-traceability-matrix.md ← 추적성 매트릭스 (출력)
                    └── 📄 026-test-specification.md  ← 테스트 명세 (출력)
```

---

## 자동 실행 플로우

### 1단계: Task 검증 및 계층적 컨텍스트 수집
**MCP**: sequential-thinking

**자동 실행 단계**:

1. **Task ID 파싱 및 검증**:
   - WBS에서 Task 찾기
   - category가 `development`인지 확인
   - 현재 상태가 `[bd]` 기본설계인지 확인

2. **기본설계 문서 존재 확인**:
   - `010-basic-design.md` 파일 존재 확인
   - 파일 없을 시 에러 반환

3. **화면설계 문서 존재 확인** (선택적):
   - `011-ui-design.md` 파일 존재 확인
   - `ui-assets/` 폴더 및 SVG 파일 존재 확인
   - 파일 없을 시 경고 출력 (에러 아님, 화면이 없는 기능일 수 있음)

4. **계층적 문서 탐색** (Task → Activity → WP → Project):
   ```
   탐색 경로:
   ├── Task 레벨
   │   ├── .jjiban/projects/{project}/tasks/{TSK-ID}/task.json
   │   ├── .jjiban/projects/{project}/tasks/{TSK-ID}/010-basic-design.md
   │   ├── .jjiban/projects/{project}/tasks/{TSK-ID}/011-ui-design.md (선택적)
   │   └── .jjiban/projects/{project}/tasks/{TSK-ID}/ui-assets/*.svg (선택적)
   │
   ├── Activity 레벨
   │   └── .jjiban/{project}/wbs/{WP-ID}/{ACT-ID}/meta.json
   │
   ├── Work Package 레벨
   │   └── .jjiban/{project}/wbs/{WP-ID}/meta.json
   │
   └── Project 레벨 (필수)
       ├── .jjiban/{project}/project.json (프로젝트 정보)
       ├── .jjiban/{project}/prd.md
       └── .jjiban/{project}/trd.md
   ```

4. **기본설계에서 PRD 참조 섹션 추출**:
   - `문서 정보` 테이블의 `PRD 참조` 필드에서 섹션 번호 추출
   - 예: `PRD 참조 | 3.1.4 작업 관리 기능` → 섹션 `3.1.4` 추출

---

### 2단계: 상위 문서 분석 및 요구사항 추출
**MCP**: sequential-thinking + context7

**자동 실행 단계**:

1. **기본설계 문서 읽기** (`010-basic-design.md`):
   ```
   추출 항목:
   ├── 문서 정보 (Task ID, Category, PRD 참조 등)
   ├── 구현 범위 / 제외 범위
   ├── 기능 요구사항 (FR-XXX)
   ├── 비즈니스 규칙 (BR-XXX)
   ├── 데이터 요구사항 (개념)
   ├── 화면 요구사항 (개념)
   ├── 인터페이스 요구사항 (개념)
   └── 수용 기준
   ```

2. **화면설계 문서 읽기** (`011-ui-design.md`, 선택적):
   ```
   추출 항목 (파일 존재 시):
   ├── 화면 목록 및 화면 ID (SCR-XX)
   ├── 화면 전환 흐름 (Mermaid stateDiagram)
   ├── 화면별 상세 설계
   │   ├── 레이아웃 구조
   │   ├── 컴포넌트 목록 및 속성
   │   └── 상태별 화면 변화
   ├── 공통 컴포넌트 (모달, 알림)
   ├── 반응형 설계 (Breakpoint)
   ├── 접근성 고려사항
   └── SVG 파일 목록 (ui-assets/*.svg 참조)
   ```

3. **PRD 원본 섹션 읽기** (`.jjiban/{project}/prd.md`):
   ```
   기본설계의 PRD 참조 섹션을 기반으로 원본 요구사항 추출:
   ├── 해당 섹션의 기능 요구사항 전문
   ├── 비즈니스 규칙 전문
   ├── 데이터 요구사항 전문
   └── 관련 화면/UI 요구사항
   ```

3. **TRD 참조 내용 읽기** (`.jjiban/{project}/trd.md`):
   ```
   추출 항목:
   ├── 기술 스택 및 버전 (정확한 버전 확인)
   ├── 모듈/컴포넌트 구조 규칙
   ├── 데이터베이스 스키마 규칙
   ├── API 설계 규칙 (네이밍, 응답 형식)
   ├── 에러 핸들링 표준
   └── 코딩 표준
   ```

4. **요구사항 ID 자동 생성**:
   - 기본설계에 요구사항 ID가 없다면 `[FR-001]`, `[BR-001]` 형식으로 자동 생성
   - 추적성 확보를 위한 고유 식별자 부여

---

### 3단계: 상세설계 문서 생성
**MCP**: context7

> ⚠️ **코드 금지 원칙 적용** - 상단의 "코드 작성 금지 원칙" 섹션 참조
> - Prisma 스키마만 코드로 작성
> - 나머지는 모두 **표, 다이어그램, 텍스트**로 표현

**자동 실행 단계**:

#### 3.1 기술 아키텍처 설계

| 설계 항목 | 표현 방식 | 코드 여부 |
|----------|----------|----------|
| 데이터베이스 ERD | Mermaid erDiagram | ❌ 코드 아님 |
| **Prisma 스키마** | 코드 블록 | ✅ **유일한 예외** |
| 백엔드 모듈 구조 | 트리 구조 + 역할 표 | ❌ |
| 프론트엔드 컴포넌트 계층 | 트리 구조 + 책임 표 | ❌ |

#### 3.2 API 상세 설계 (모두 표 형식)

**엔드포인트 목록 표**:
| Method | Path | 설명 | 인증 |
|--------|------|------|------|

**Request 필드 표**:
| 필드명 | 타입 | 필수 | 설명 | 유효성 규칙 |
|--------|------|------|------|------------|

**Response 필드 표**:
| 필드명 | 타입 | 설명 |
|--------|------|------|

**에러 응답 표**:
| 에러코드 | HTTP 상태 | 메시지 | 발생 조건 |
|---------|----------|--------|----------|

#### 3.3 UI/UX 상세 설계 (모두 표/Text Art)

> 📐 **화면설계 참조**: `011-ui-design.md` 존재 시 해당 문서 기반으로 상세화

**컴포넌트 Props 표**:
| 컴포넌트명 | Prop명 | 타입 | 필수 | 설명 |
|-----------|--------|------|------|------|

**컴포넌트 Events 표**:
| 컴포넌트명 | Event명 | Payload | 설명 |
|-----------|---------|---------|------|

**상태 관리 구조 표**:
| 상태명 | 타입 | 초기값 | 설명 |
|--------|------|--------|------|

**화면 레이아웃**: Text Art 와이어프레임

**data-testid 목록 표**:
| 요소 | data-testid | 용도 |
|------|-------------|------|

#### 3.4 비즈니스 로직 설계 (다이어그램/표)

| 설계 항목 | 표현 방식 |
|----------|----------|
| 처리 흐름 | Mermaid sequenceDiagram |
| 서비스 메서드 목록 | 표 (메서드명, 파라미터, 반환값, 책임) |
| BR 구현 위치 매핑 | 표 (BR-ID → 구현 레이어 → 메서드명) |

#### 3.5 테스트 시나리오 설계 (모두 표 형식)

> ⛔ 테스트 코드(describe, it, expect) 작성 금지 - 시나리오만 표로 정의

**단위 테스트 시나리오 표**:
| 테스트 ID | 대상 | 시나리오 | 입력 | 예상 결과 |
|----------|------|---------|------|----------|

**E2E 테스트 시나리오 표**:
| 테스트 ID | 사용자 액션 | 검증 포인트 | data-testid |
|----------|------------|------------|-------------|

**테스트 데이터 명세 표**:
| 데이터 ID | 유형 | 필드값 | 용도 |
|----------|------|--------|------|

---

### 4단계: 상위 문서 일관성 검증 🔍
**MCP**: sequential-thinking

> ⚠️ **중요**: 이 단계는 상위 문서(PRD, TRD, 기본설계)와의 논리 충돌 및 누락을 방지합니다.

**자동 실행 단계**:

#### 4.1 PRD ↔ 기본설계 일관성 검증
```
검증 항목:
├── [CHK-PRD-01] 기능 요구사항 완전성
│   └── PRD 섹션의 모든 기능이 기본설계에 포함되었는가?
│
├── [CHK-PRD-02] 비즈니스 규칙 일치성
│   └── PRD의 비즈니스 규칙이 기본설계에 정확히 반영되었는가?
│
├── [CHK-PRD-03] 용어 일관성
│   └── PRD와 기본설계에서 동일 개념에 동일 용어를 사용하는가?
│
└── [CHK-PRD-04] 범위 일치성
    └── 기본설계의 "구현 범위"가 PRD 범위를 벗어나지 않는가?
```

#### 4.2 기본설계 ↔ 상세설계 일관성 검증
```
검증 항목:
├── [CHK-BD-01] 기능 요구사항 완전성
│   └── 기본설계의 모든 FR-XXX가 상세설계에 구현 방법이 명시되었는가?
│
├── [CHK-BD-02] 비즈니스 규칙 구현 명세
│   └── 기본설계의 모든 BR-XXX에 대해 구현 위치와 방식이 정의되었는가?
│
├── [CHK-BD-03] 데이터 모델 일치성
│   └── 기본설계 데이터 요구사항 → Prisma 스키마 매핑이 정확한가?
│
├── [CHK-BD-04] 인터페이스 일치성
│   └── 기본설계 인터페이스 요구사항 → API 엔드포인트 매핑이 정확한가?
│
├── [CHK-BD-05] 화면 일치성
│   └── 기본설계 화면 요구사항 → 컴포넌트 구조 매핑이 정확한가?
│
└── [CHK-BD-06] 수용 기준 구현 가능성
    └── 기본설계 수용 기준이 상세설계의 테스트케이스로 변환되었는가?
```

#### 4.3 기본설계 ↔ 화면설계 일관성 검증 (선택적)
> 📐 `011-ui-design.md` 존재 시에만 수행

```
검증 항목:
├── [CHK-UI-01] 화면 목록 완전성
│   └── 기본설계 화면 요구사항의 모든 화면이 화면설계에 포함되었는가?
│
├── [CHK-UI-02] 화면 흐름 일치성
│   └── 기본설계의 사용자 시나리오가 화면설계 전환 흐름과 일치하는가?
│
├── [CHK-UI-03] 컴포넌트 커버리지
│   └── 기본설계의 기능 요구사항(FR-XXX)이 화면설계 컴포넌트에 매핑되었는가?
│
├── [CHK-UI-04] 상태 정의 완전성
│   └── 기본설계의 에러/예외 케이스가 화면설계 상태별 변화에 반영되었는가?
│
└── [CHK-UI-05] 화면설계 ↔ 상세설계 동기화
    └── 화면설계의 컴포넌트 구조가 상세설계 UI/UX 섹션에 정확히 반영되었는가?
```

#### 4.5 TRD ↔ 상세설계 일관성 검증
```
검증 항목:
├── [CHK-TRD-01] 기술 스택 준수
│   └── 상세설계가 TRD에 정의된 기술 스택/버전을 사용하는가?
│
├── [CHK-TRD-02] 아키텍처 패턴 준수
│   └── 모듈 구조, 디렉토리 구조가 TRD 규칙을 따르는가?
│
├── [CHK-TRD-03] API 설계 규칙 준수
│   └── 엔드포인트 네이밍, 응답 형식이 TRD 표준을 따르는가?
│
├── [CHK-TRD-04] DB 스키마 규칙 준수
│   └── Prisma 모델이 TRD의 네이밍/컨벤션을 따르는가?
│
└── [CHK-TRD-05] 에러 핸들링 표준 준수
    └── 에러 코드, 응답 형식이 TRD 표준을 따르는가?
```

#### 4.6 논리 충돌 감지
```
충돌 유형:
├── [CONFLICT-01] 용어 불일치
│   예: PRD "프로젝트" vs 상세설계 "Project" vs 기본설계 "프로젝트"
│
├── [CONFLICT-02] 범위 불일치
│   예: PRD에 없는 기능이 상세설계에 포함됨
│
├── [CONFLICT-03] 데이터 타입 불일치
│   예: 기본설계 "문자열" vs Prisma "Int"
│
├── [CONFLICT-04] 비즈니스 규칙 모순
│   예: BR-001 "관리자만 삭제 가능" vs API "모든 사용자 삭제 허용"
│
└── [CONFLICT-05] 기술 스택 불일치
    예: TRD "Element Plus" vs 상세설계 "Vuetify"
```

#### 4.7 검증 결과 출력 형식
```
┌─────────────────────────────────────────────────────────────┐
│ 📋 일관성 검증 결과                                          │
├─────────────────────────────────────────────────────────────┤
│ ✅ 통과: X개 | ⚠️ 경고: Y개 | ❌ 실패: Z개                    │
├─────────────────────────────────────────────────────────────┤
│ [PASS] CHK-PRD-01: 기능 요구사항 완전성                      │
│ [PASS] CHK-PRD-02: 비즈니스 규칙 일치성                      │
│ [WARN] CHK-PRD-03: 용어 일관성                               │
│        → "프로젝트"와 "Project" 혼용 (통일 권장)             │
│ [FAIL] CHK-TRD-01: 기술 스택 준수                            │
│        → TRD: Element Plus 2.11.x, 상세설계: 버전 미명시     │
├─────────────────────────────────────────────────────────────┤
│ 📌 조치 필요 사항:                                           │
│ 1. [WARN] 용어 통일 (선택)                                   │
│ 2. [FAIL] Element Plus 버전 명시 (필수)                      │
└─────────────────────────────────────────────────────────────┘
```

---

### 5단계: 추적성 매트릭스 생성
**MCP**: sequential-thinking

**자동 실행 단계**:

1. **요구사항 추적성 매트릭스**:
   - `PRD 섹션 → 기본설계 섹션 → 상세설계 섹션` 3단계 매핑
   - 누락된 요구사항 자동 감지

2. **비즈니스 규칙 추적성 매트릭스**:
   - `BR-XXX → 구현 위치 → 테스트케이스` 매핑

3. **데이터 모델 추적성 매트릭스**:
   - `기본설계 엔티티 → Prisma 모델 → API DTO` 매핑

---

### 6단계: UI 테스트케이스 생성

**자동 실행 단계**:
1. **UI 컴포넌트 기반 테스트케이스 설계**:
   - 화면 요소별 동작 테스트
   - 사용자 시나리오 기반 흐름 테스트
   - 반응형 및 접근성 테스트케이스

2. **매뉴얼 테스트케이스 작성**:
   - 사람이 직접 실행 가능한 테스트 단계
   - 예상 결과 및 검증 기준 명시
   - 우선순위 및 중요도 분류

---

### 7단계: Task JSON 상태 업데이트

1. `[bd]` → `[dd]` 상태 변경 (Task JSON의 status 필드)
2. updated_at 필드 업데이트
3. Task JSON 파일 저장

---

## 상세설계 문서 템플릿 (3개 파일 분할)

### 핵심 원칙 ⛔

> **코드 금지 원칙 재확인** - 상단 "코드 작성 금지 원칙" 섹션 필수 준수

| 원칙 | 설명 |
|------|------|
| ⛔ 코드 금지 | TypeScript, Vue, SQL, 테스트 코드 블록 **절대 불가** |
| ✅ DB 스키마 예외 | Prisma 스키마 코드만 허용 |
| ✅ 표 형식 | 모든 명세는 표(Table)로 작성 |
| ✅ 다이어그램 | ERD, 시퀀스, 상태 전환은 Mermaid로 |
| ✅ 텍스트 설명 | 로직, 규칙은 자연어로 설명 |

**코드 블록 감지 시**: 즉시 중단하고 표/다이어그램으로 변환

- 상위 문서(PRD, TRD, 기본설계)와의 **일관성 검증 결과** 포함
- **문서 분할**: 파일 크기 최적화를 위해 3개 파일로 분리

### 생성 문서 목록

| 파일명 | 템플릿 | 내용 |
|--------|--------|------|
| `020-detail-design.md` | `.jjiban/templates/020-detail-design.md` | 상세설계 본문 |
| `025-traceability-matrix.md` | `.jjiban/templates/025-traceability-matrix.md` | 요구사항 추적성 매트릭스 |
| `026-test-specification.md` | `.jjiban/templates/026-test-specification.md` | 테스트 시나리오/케이스/데이터 |

### 020-detail-design.md 주요 섹션

| # | 섹션 | 내용 |
|---|------|------|
| 0 | 메타데이터 | Task ID, 상위 문서 참조, 분할 문서 참조 |
| 1 | 일관성 검증 결과 | CHK-PRD, CHK-BD, CHK-TRD 검증 결과 |
| 2 | 목적 및 범위 | 기술 목표, 포함/제외 범위 |
| 3 | 기술 스택 | TRD 기준 사용 기술 |
| 4 | 용어/가정/제약 | 정의, 가정, 제약조건 |
| 5 | 시스템/모듈 구조 | 역할, 책임, 의존성 (개념) |
| 6 | 데이터 모델 | ERD, 필드 정의 (개념) |
| 7 | 인터페이스 계약 | API 엔드포인트, 요청/응답 (표 형식) |
| 8 | 프로세스 흐름 | 시퀀스/상태 다이어그램 (Mermaid) |
| 9 | UI 설계 | Text Art + 컴포넌트/상태 (개념) |
| 10 | 비즈니스 규칙 구현 | BR-XXX 구현 방안 |
| 11 | 오류/예외 처리 | 예상 오류, 복구 전략 |
| 12 | 구현 체크리스트 | Backend/Frontend/품질 체크 |

### 025-traceability-matrix.md 주요 섹션

| # | 섹션 | 내용 |
|---|------|------|
| 1 | 기능 요구사항 추적 | FR → PRD → 기본설계 → 상세설계 → 테스트 매핑 |
| 2 | 비즈니스 규칙 추적 | BR → 구현 위치 → 테스트 매핑 |
| 3 | 테스트 역추적 | 테스트 ID → 요구사항 역방향 매핑 |
| 4-6 | 데이터/인터페이스/화면 추적 | 설계 요소별 추적 |
| 7 | 추적성 검증 요약 | 커버리지 통계, 미매핑 항목 |

### 026-test-specification.md 주요 섹션

| # | 섹션 | 내용 |
|---|------|------|
| 1 | 테스트 전략 개요 | 범위, 환경, 목표 커버리지 |
| 2 | 단위 테스트 시나리오 | UT-XXX 케이스 상세 |
| 3 | E2E 테스트 시나리오 | E2E-XXX 케이스 상세 |
| 4 | UI 테스트케이스 (매뉴얼) | TC-XXX 케이스 |
| 5 | 테스트 데이터 (Fixture) | Mock 데이터, 시드 데이터, 계정 |
| 6 | data-testid 목록 | 페이지별 셀렉터 정의 |
| 7 | 테스트 커버리지 목표 | 목표치 정의 |

---

## 출력 예시

```
[wf:draft] 상세설계 시작

Task: TSK-01-01-01
Category: development
상태 전환: [bd] 기본설계 → [dd] 상세설계

📂 계층적 문서 탐색:
├── Task: TSK-01-01-01/
│   ├── 010-basic-design.md ✅
│   ├── 011-ui-design.md ✅ (화면설계 참조)
│   └── ui-assets/ ✅ (SVG 7개)
├── Activity: ACT-01-01_project-management/ (개요 없음)
├── Work Package: WP-01_core-issue-management/ (개요 없음)
└── Project:
    ├── jjiban-prd.md ✅ (참조 섹션: 3.1.4)
    ├── jjiban-trd.md ✅
    └── wbs.md ✅

📋 기본설계 문서 분석:
- 기능 요구사항: 6개 (FR-001 ~ FR-006)
- 비즈니스 규칙: 6개 (BR-001 ~ BR-006)
- 화면 요구사항: 4개
- 인터페이스 요구사항: 7개
- 수용 기준: 9개

📐 화면설계 문서 분석:
- 화면 목록: 4개 (SCR-01 ~ SCR-04)
- 화면 전환 흐름: 1개 (Mermaid stateDiagram)
- 컴포넌트 정의: 12개
- 상태별 화면: 7개 (SVG)
- 접근성 고려사항: 3개

🔧 상위 문서 참조 추출:
- PRD 섹션 3.1.4: Project 관리 기능 요구사항
- TRD 기술 스택: Vue 3.5.x, NestJS 11.x, Prisma 7.x
- TRD API 규칙: RESTful, kebab-case 엔드포인트

🔍 일관성 검증 결과:
┌─────────────────────────────────────────────────────────────┐
│ ✅ 통과: 17개 | ⚠️ 경고: 1개 | ❌ 실패: 0개                  │
├─────────────────────────────────────────────────────────────┤
│ [PASS] CHK-PRD-01: 기능 요구사항 완전성                      │
│ [PASS] CHK-PRD-02: 비즈니스 규칙 일치성                      │
│ [WARN] CHK-PRD-03: 용어 일관성                               │
│        → "프로젝트"와 "Project" 혼용 (통일 권장)             │
│ [PASS] CHK-BD-01 ~ CHK-BD-06: 기본설계 일관성 검증           │
│ [PASS] CHK-UI-01 ~ CHK-UI-05: 화면설계 일관성 검증 ⭐        │
│ [PASS] CHK-TRD-01 ~ CHK-TRD-05: TRD 준수 검증                │
└─────────────────────────────────────────────────────────────┘

📊 추적성 매트릭스 생성:
- PRD → 기본설계 → 상세설계: 6개 요구사항 매핑 완료
- 비즈니스 규칙 → 구현 위치: 6개 규칙 매핑 완료
- 화면설계 → 상세설계 UI/UX: 4개 화면, 12개 컴포넌트 매핑 완료

📄 생성된 문서:
├── 020-detail-design.md (상세설계 본문)
│   ├── 상위 문서 참조 섹션 포함
│   ├── 화면설계 참조 섹션 포함 ⭐
│   └── 일관성 검증 결과 포함
├── 025-traceability-matrix.md (추적성 매트릭스)
│   └── FR/BR → 설계 → 테스트 매핑
└── 026-test-specification.md (테스트 명세)
    ├── 단위 테스트 시나리오 (UT-XXX)
    ├── E2E 테스트 시나리오 (E2E-XXX)
    └── 테스트 데이터 (Fixture)

다음 단계: /wf:build TSK-01-01-01
```

---

## 에러 케이스

### ⛔ 코드 블록 감지 에러 (최우선)

| 감지 패턴 | 에러 메시지 |
|----------|------------|
| `function`, `const`, `let`, `var` | `[ERROR] TypeScript/JavaScript 코드 감지. 표로 변환 필요.` |
| `<template>`, `<script>`, `defineComponent` | `[ERROR] Vue 컴포넌트 코드 감지. Props/Events 표로 변환 필요.` |
| `describe(`, `it(`, `test(`, `expect(` | `[ERROR] 테스트 코드 감지. 테스트 시나리오 표로 변환 필요.` |
| `SELECT`, `INSERT`, `UPDATE`, `DELETE` | `[ERROR] SQL 쿼리 감지. ERD + 필드 표로 변환 필요.` |
| `interface`, `type`, `export` | `[ERROR] TypeScript 타입 코드 감지. 필드 정의 표로 변환 필요.` |
| `async function`, `await`, `.then(` | `[ERROR] 비동기 코드 감지. 시퀀스 다이어그램으로 변환 필요.` |

**예외 허용**: `model`, `@@`, `@relation` (Prisma 스키마 키워드)

### 기타 에러

| 에러 | 메시지 |
|------|--------|
| 잘못된 category | `[ERROR] development category만 지원합니다. 현재: [category]` |
| 잘못된 상태 | `[ERROR] 기본설계 상태가 아닙니다. 현재 상태: [상태]` |
| 기본설계 미완료 | `[ERROR] 010-basic-design.md 파일이 없습니다` |
| 추적성 매트릭스 생성 실패 | `[ERROR] 025-traceability-matrix.md 생성에 실패했습니다` |
| 테스트 명세 생성 실패 | `[ERROR] 026-test-specification.md 생성에 실패했습니다` |
| PRD 미발견 | `[ERROR] PRD 파일을 찾을 수 없습니다: .jjiban/{project}/prd.md` |
| TRD 미발견 | `[ERROR] TRD 파일을 찾을 수 없습니다: .jjiban/{project}/trd.md` |
| PRD 섹션 미발견 | `[WARN] 기본설계에 PRD 참조 섹션이 명시되지 않았습니다` |
| 화면설계 미발견 | `[INFO] 011-ui-design.md 파일이 없습니다. 화면이 없는 기능이거나 /wf:ui 미실행` |
| 화면설계 SVG 누락 | `[WARN] ui-assets/ 폴더가 비어있습니다. SVG 파일이 생성되지 않았습니다` |
| 화면설계 불일치 | `[WARN] CHK-UI-03: 기본설계 FR-002가 화면설계 컴포넌트에 매핑되지 않았습니다` |
| 일관성 검증 실패 | `[FAIL] CHK-TRD-01: 기술 스택 불일치 - TRD: Element Plus 2.11.x, 상세설계: 버전 미명시` |
| 요구사항 누락 | `[WARN] 누락된 요구사항: FR-003, BR-002 (PRD에 있으나 기본설계에 없음)` |
| 범위 초과 | `[WARN] 범위 초과: FR-007 (기본설계에 있으나 PRD에 없음)` |

---

## 일관성 검증 실패 시 처리

1. **[FAIL] 항목이 있는 경우**:
   - 상세설계 문서 생성을 **중단**
   - 실패 항목 목록과 수정 가이드 출력
   - 사용자에게 기본설계 또는 PRD/TRD 수정 요청

2. **[WARN] 항목만 있는 경우**:
   - 상세설계 문서 생성 **진행**
   - 경고 항목을 문서 내 `일관성 검증 결과` 섹션에 기록
   - 설계리뷰 시 검토 필요 항목으로 표시

---

## 다음 명령어

- `/wf:build` - 구현 시작
- `/wf:review` - LLM 설계 리뷰 실행 (상태 변경 없음, 반복 가능)

---

## WP/ACT 단위 병렬 처리

### 병렬 처리 출력 예시

```
[wf:draft] 상세설계 시작 (병렬 처리)

입력: ACT-01-01 (Activity)
범위: Project 관리 기능
전체 Task: 5개
대상 Task: 3개 (상태 필터: [bd] 기본설계)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📦 병렬 처리 진행:
├── [1/3] TSK-01-01-01: Project CRUD 구현 ✅ → [dd]
├── [2/3] TSK-01-01-02: Project 대시보드 ✅ → [dd]
└── [3/3] TSK-01-01-03: Project 아카이브 ✅ → [dd]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 처리 결과:
├── 성공: 3개
├── 실패: 0개
└── 스킵: 2개 (이미 상세설계 완료)

다음 단계: /wf:build ACT-01-01 (또는 개별 Task별 실행)
```

---

## 마지막 단계: 자동 Git Commit

@.claude/includes/wf-auto-commit.md

---

<!--
jjiban 프로젝트 - Workflow Command
author: 장종익
Command: wf:draft
Version: 1.0

Changes (v1.0):
- 생성
-->
