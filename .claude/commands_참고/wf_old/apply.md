---
name: wf:apply
description: "development Task 설계 리뷰 내용 반영. 상태 변경 없음, 반복 가능"
category: workflow
hierarchy-input: true
parallel-processing: true
allowed-tools: [Read, Write, Edit, Glob, Grep, Bash, Task, mcp__sequential-thinking__sequentialthinking, mcp__context7__resolve-library-id, mcp__context7__get-library-docs]
---

# /wf:apply - 리뷰 내용 설계서 반영

> **상태 내 액션**: 상태 변경 없음, 반복 가능
> **사용 가능 상태**: `[dd]` 상세설계
> **적용 category**: development only

## 🎯 핵심 원칙

- **맥락 기반 선택적 적용**: 무조건 적용 금지
- **P1-P2 집중 처리**: 필수 사항 우선 반영
- **판단 근거 명시**: 모든 적용/보류 결정에 사유 기록

## 사용법

```bash
/wf:apply [WP-ID | ACT-ID | Task-ID] [--review N]

# 예시
/wf:apply TSK-01-01-01           # 단일 Task (최신 리뷰 기준)
/wf:apply TSK-01-01-01 --review 2 # 특정 리뷰 회차 기준 반영
/wf:apply ACT-01-01              # Activity 내 모든 Task 병렬 처리
/wf:apply WP-01                  # Work Package 내 모든 Task 병렬 처리
```

## 계층 입력 처리

@.claude/includes/wf-hierarchy-input.md

| 입력 타입 | 처리 방식 | 상태 필터 |
|-----------|----------|----------|
| `TSK-XX-XX-XX` | 단일 Task 처리 | `[dd]` 상세설계 |
| `ACT-XX-XX` | ACT 내 Task 병렬 처리 | `[dd]` 상태만 |
| `WP-XX` | WP 내 Task 병렬 처리 | `[dd]` 상태만 |

## 동작 규칙

| category | 사용 가능 상태 | 상태 변경 | 수정 문서 |
|----------|--------------|----------|----------|
| development | `[dd]` 상세설계 | 없음 (반복 가능) | `020-detail-design.md` |

## 문서 경로

@.claude/includes/wf-common.md

## 개념 충돌 해결

@.claude/includes/wf-conflict-resolution.md

**Task 폴더**: `.orchay/projects/{project}/tasks/{TSK-ID}/`

---

## 실행 플로우

### 1단계: Task 검증 및 문서 로드

1. **Task 정보 확인**:
   - WBS에서 Task 찾기
   - category가 `development`인지 확인
   - 현재 상태가 `[dd]` 상세설계인지 확인

2. **문서 로드** (분할된 상세설계 문서):
   - **상세설계서**: `[Task폴더]/020-detail-design.md` (필수)
   - **추적성 매트릭스**: `[Task폴더]/025-traceability-matrix.md` (필수)
   - **테스트 명세**: `[Task폴더]/026-test-specification.md` (필수)
   - **기본설계서**: `[Task폴더]/010-basic-design.md` (참조)
   - **PRD**: `.orchay/{project}/prd.md` (참조)
   - **TRD**: `.orchay/{project}/trd.md` (참조)

3. **리뷰 문서 탐색**:
   ```
   리뷰 문서 탐색 순서:
   1. "(적용완료)" 표시가 없는 리뷰 문서 중 최신 찾기 (기본)
   2. --review 옵션 지정 시 해당 회차 문서 사용
   3. "(적용완료)" 파일은 탐색에서 제외

   예시:
   ├── 021-design-review-claude-1(적용완료).md  ← 제외
   ├── 021-design-review-claude-2.md           ← 최신 (대상)
   └── 021-design-review-gemini-1(적용완료).md ← 제외
   ```

### 2단계: 맥락 기반 적용 가능성 분석

> ⚠️ **중요**: 리뷰 이슈를 무조건 적용하지 않음

각 이슈에 대해 다음 관점에서 분석:

#### 2.1 시스템 적합성 검토
- 현재 아키텍처와 호환되는가?
- 기술 스택(TRD)과 충돌하지 않는가?
- 시스템 복잡도를 적절히 유지하는가?

#### 2.2 Task 범위 적합성 검토
- 해당 Task의 요구사항과 관련 있는가?
- 범위 내 변경인가?
- 다른 Task에 영향을 주지 않는가?

#### 2.3 실현 가능성 검토
- 현재 설계 수준에서 구현 가능한가?
- 비용 대비 효과가 있는가?
- 일정 내 완료 가능한가?

#### 2.4 적용 판단 결정

| 판단 | 조건 | 처리 |
|------|------|------|
| ✅ **적용** | 시스템&Task 적합, 실현 가능 | 그대로 반영 |
| 📝 **조정 적용** | 취지는 유효하나 현재 시스템에 맞춤 필요 | 수정하여 반영 |
| ⏸️ **보류** | 맥락 부적합, 범위 초과, 실현 어려움 | 미반영 (사유 기록) |

#### 2.5 우선순위별 처리 기준

| 우선순위 | 처리 기준 |
|----------|----------|
| 🔴 P1 | 필수 적용 (조정 가능하나 반드시 해결) |
| 🟠 P2 | 적용 권장 (적합성 체크리스트 통과 시) |
| 🟡 P3 | 선별 적용 (효과가 명확한 경우만) |
| ⚪ P4-P5 | 선택적 적용 (향후 고려 가능) |

### 3단계: 영역별 개선 반영

> MCP: `sequential-thinking` 활용하여 체계적 분석

#### 3.1 아키텍처 개선 (P1-P2 우선)
- 컴포넌트 구조 및 책임 분리 개선
- 데이터 흐름 및 API 인터페이스 수정
- 의존성 관리 전략 보완
- DB 스키마 정규화 및 무결성 제약

#### 3.2 보안 개선 (P1-P2 우선)
- OWASP Top 10 대응 보완
- 인증/인가 메커니즘 강화
- 입력 유효성 검증 보완
- 민감 데이터 보호 전략

#### 3.3 성능/품질 개선
- 병목 지점 해소 방안
- 캐싱 전략 보완
- SOLID, DRY, KISS 원칙 적용
- 테스트 가능성 개선

### 4단계: 설계 문서 업데이트

**수정 대상** (분할된 3개 문서):
- `020-detail-design.md`: 상세설계 본문 (주요 수정 대상)
- `025-traceability-matrix.md`: 추적성 매트릭스 (요구사항 매핑 변경 시)
- `026-test-specification.md`: 테스트 명세 (테스트 관련 이슈 반영 시)

**수정 방식**:
1. 리뷰 이슈의 관련 섹션 및 대상 문서 식별
2. 해당 문서의 섹션에 개선 사항 반영
3. 문서 간 상호 참조 일관성 확인

**수정 시 주의사항**:
- 기존 설계의 일관성 유지
- 변경 범위 최소화 (과도한 수정 지양)
- 기본설계서와의 정합성 확인
- 3개 분할 문서 간 일관성 유지

### 5단계: 적용 검증

1. **문서 일관성 검증**:
   - 기본설계 ↔ 상세설계 정합성
   - 수정 섹션 간 일관성

2. **요구사항 추적성 확인**:
   - 요구사항 커버리지 유지 (95% 이상)
   - 누락된 요구사항 없음

3. **P1-P2 이슈 해결 확인**:
   - 모든 P1 이슈 처리됨
   - P2 이슈 80% 이상 처리됨

### 6단계: 리뷰 문서 업데이트 및 파일명 변경

#### 6.1 적용 결과 섹션 추가
> 기존 리뷰 문서 **끝에** 다음 섹션 추가

#### 6.2 파일명 변경 (적용 완료 표시)
> 적용 결과 추가 후 파일명에 "(적용완료)" 추가

```
변경 전: 021-design-review-claude-1.md
변경 후: 021-design-review-claude-1(적용완료).md
```

**파일명 변경 규칙**:
- 확장자(.md) 앞에 `(적용완료)` 추가
- 이미 "(적용완료)"가 있는 경우 변경하지 않음
- 변경된 파일은 이후 `/wf:apply` 탐색에서 제외됨

```markdown
---

## 7. 개선사항 적용 결과

**적용일**: {YYYY-MM-DD}
**적용자**: Claude Opus 4.5
**수정 문서**: `020-detail-design.md`

### 7.1 적용 방침
- ✅ 시스템&Task 적합 → 적용
- 📝 조정 필요 → 수정 적용
- ⏸️ 부적합 → 보류

### 7.2 적용 완료 이슈

#### [ISS-XXX] 이슈 제목 (P1/P2)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | [리뷰에서 제안한 내용] |
| **적용 방식** | ✅ 그대로 / 📝 조정 |
| **반영 내용** | [실제 반영한 내용] |
| **수정 섹션** | [상세설계서 섹션 번호] |
| **적용 사유** | [판단 근거] |

### 7.3 보류 이슈

#### [ISS-XXX] 이슈 제목 (P3/P4)
| 항목 | 내용 |
|------|------|
| **원본 권장사항** | [리뷰에서 제안한 내용] |
| **보류 사유** | [판단 근거] |
| **대안/향후 계획** | [대안 방안 또는 향후 고려 시점] |

### 7.4 적용 결과 요약

| 구분 | P1 | P2 | P3 | P4 | P5 | 합계 |
|------|----|----|----|----|----|----|
| 리뷰 이슈 | {n} | {n} | {n} | {n} | {n} | {n} |
| ✅ 적용 | {n} | {n} | {n} | {n} | {n} | {n} |
| 📝 조정 적용 | {n} | {n} | {n} | {n} | {n} | {n} |
| ⏸️ 보류 | {n} | {n} | {n} | {n} | {n} | {n} |

**카테고리별**:
- 🏗️ 아키텍처: {n}개 적용 / {n}개 보류
- 🛡️ 보안: {n}개 적용 / {n}개 보류
- ⚡ 성능: {n}개 적용 / {n}개 보류
- 📝 품질: {n}개 적용 / {n}개 보류

### 7.5 주요 변경 내역

| # | 섹션 | 변경 요약 |
|---|------|----------|
| 1 | [섹션] | [변경 내용 요약] |
| 2 | [섹션] | [변경 내용 요약] |

### 7.6 개선 효과

- **설계 품질**: [개선 효과]
- **리스크 해소**: [해결된 리스크]
- **요구사항 커버리지**: {이전}% → {이후}%
```

---

## 맥락 기반 판단 체크리스트

각 이슈에 대해 다음 질문에 답변:

### 시스템 적합성
- [ ] 현재 아키텍처와 호환되는가?
- [ ] 기술 스택(NestJS, Vue, Prisma 등)과 충돌 없는가?
- [ ] 시스템 복잡도가 적절히 유지되는가?

### Task 적합성
- [ ] 해당 Task 요구사항과 관련 있는가?
- [ ] 범위 내 변경인가?
- [ ] 다른 Task에 영향을 주지 않는가?

### 실현 가능성
- [ ] 설계 수준에서 명세 가능한가?
- [ ] 비용 대비 효과가 있는가?
- [ ] 구현 일정에 영향 없는가?

---

## 적용 vs 보류 판단 예시

### ✅ 적용 예시
- P1 보안 이슈 → 인증 강화 (시스템 적합 & 필수)
- P2 아키텍처 → API 일관성 개선 (범위 내 & 구현 가능)
- P3 성능 → 인덱스 추가 (기술 스택 가능 & 효과 큼)

### 📝 조정 적용 예시
- 리뷰: Redis 캐싱 도입 → 적용: 인메모리 캐싱으로 조정 (현재 스택에 맞춤)
- 리뷰: GraphQL 전환 → 적용: REST API 최적화 (현재 스택 유지)
- 리뷰: 복잡한 RBAC → 적용: 단순 권한 체계 (현재 범위에 맞춤)

### ⏸️ 보류 예시
- P2 마이크로서비스 전환 (범위 초과, 현재 모놀리식 유지)
- P3 새 프레임워크 도입 (기술 스택 TRD 위반)
- P4 과도한 추상화 (효과 낮음, 복잡도 증가)

---

## 출력 예시

```
[wf:apply] 리뷰 내용 설계서 반영

Task: TSK-01-01-01
Category: development
현재 상태: [dd] 상세설계 (변경 없음)

기준 리뷰 문서: 021-design-review-claude-2.md

맥락 분석 결과:
├── 시스템 적합성: 5/5 이슈 호환
├── Task 범위 적합성: 4/5 이슈 범위 내
└── 실현 가능성: 4/5 이슈 가능

적용 판단:
├── ✅ 적용: 3건
├── 📝 조정 적용: 1건
└── ⏸️ 보류: 1건 (범위 초과)

우선순위별 처리:
├── [P1] 0/0 처리 (없음)
├── [P2] 2/2 처리 완료 ✅
├── [P3] 1/1 처리 완료 ✅
├── [P4] 1/2 처리 (1건 보류)
└── [P5] 0/0 처리 (없음)

수정된 문서:
├── 020-detail-design.md (상세설계 업데이트)
├── 025-traceability-matrix.md (추적성 매트릭스, 필요 시)
├── 026-test-specification.md (테스트 명세, 필요 시)
└── 021-design-review-claude-2.md → 021-design-review-claude-2(적용완료).md

변경 섹션:
├── 7. 데이터 모델 - 인덱스 전략 추가
├── 8. 인터페이스 계약 - 에러 응답 형식 표준화
└── 12. 오류/예외 처리 - 유효성 검증 강화

다음 단계:
- 재리뷰: /wf:review TSK-01-01-01
- 다른 LLM 리뷰: /wf:review TSK-01-01-01 --llm gemini
- 구현 진행: /wf:build TSK-01-01-01
```

---

## 반복 리뷰-반영 사이클

```
[dd] 상세설계
      │
      ├── /wf:review ───→ 021-design-review-{llm}-{n}.md
      │                          │
      │                          ▼
      ├── /wf:apply ────→ 020-detail-design.md (수정)
      │                   021-design-review-{llm}-{n}(적용완료).md (파일명 변경)
      │                          │
      │                          ▼
      ├── /wf:review ───→ 021-design-review-{llm}-{n+1}.md (새 리뷰)
      │                          │
      └── (반복 가능) ──────────────┘
      │
      └── /wf:build → [im] 구현

파일 상태 예시:
├── 021-design-review-claude-1(적용완료).md  ← 1차 적용 완료
├── 021-design-review-gemini-1(적용완료).md  ← 교차 리뷰 적용 완료
├── 021-design-review-claude-2.md           ← 미적용 (다음 apply 대상)
└── 020-detail-design.md                    ← 최신 설계서
```

---

## 성공 기준

### 필수
1. ✅ 맥락 기반 판단: 모든 이슈에 적용/보류/조정 근거 명시
2. ✅ P1 100% 처리 (조정 가능)
3. ✅ P2 80% 이상 처리
4. ✅ 설계 문서 업데이트 완료
5. ✅ 리뷰 문서에 적용 결과 추가
6. ✅ 기본-상세설계 일관성 유지
7. ✅ 요구사항 추적성 95% 이상 유지

### 권장
- P3 선별 처리 (효과 명확한 것)
- 보류 이슈에 대안/향후 계획 제시
- P4-P5 향후 고려 사항 정리

### ⚠️ 금지
1. ❌ 맹목적 전체 적용 (맥락 무시)
2. ❌ 판단 근거 누락
3. ❌ 과도한 아키텍처 변경
4. ❌ Task 범위 초과 변경
5. ❌ TRD 기술 스택 위반

---

## 에러 케이스

| 에러 | 메시지 |
|------|--------|
| 잘못된 category | `[ERROR] development category만 지원합니다` |
| 잘못된 상태 | `[ERROR] 상세설계 상태가 아닙니다. 현재 상태: [상태]` |
| 상세설계 없음 | `[ERROR] 020-detail-design.md 파일이 없습니다` |
| 리뷰 문서 없음 | `[ERROR] 리뷰 문서가 없습니다. /wf:review를 먼저 실행하세요` |
| 리뷰 회차 없음 | `[ERROR] 지정된 리뷰 회차([N])가 존재하지 않습니다` |
| 미적용 리뷰 없음 | `[WARN] 적용 가능한 리뷰 문서가 없습니다. 모든 리뷰가 이미 적용되었습니다` |
| 이미 적용된 리뷰 | `[WARN] 해당 리뷰는 이미 적용되었습니다: [파일명](적용완료).md` |

## WP/ACT 단위 병렬 처리

WP 또는 ACT 단위 입력 시, 해당 범위 내 `[dd]` 상태 Task들에 리뷰 내용을 병렬로 반영합니다.

```
[wf:apply] 워크플로우 시작 (병렬 처리)

입력: ACT-01-01 (Activity)
범위: Project 관리 기능
대상 Task: 4개 (상태 필터 적용: 3개)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📦 병렬 처리 진행 상황:
├── [1/3] TSK-01-01-01: Project CRUD 반영 ✅
├── [2/3] TSK-01-01-02: Project 대시보드 반영 ✅
└── [3/3] TSK-01-01-03: Project 검색 반영 🔄 진행중

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 처리 결과 요약:
├── 성공: 3개
├── 실패: 0개
└── 스킵: 1개 (TSK-01-01-04: 리뷰 문서 없음)

수정된 문서:
├── TSK-01-01-01/020-detail-design.md
├── TSK-01-01-02/020-detail-design.md
└── TSK-01-01-03/020-detail-design.md

다음 단계: 개별 Task별 /wf:build 실행
```

---

## 관련 명령어

| 명령어 | 설명 |
|--------|------|
| `/wf:review` | LLM 설계 리뷰 실행 |
| `/wf:build` | 구현 시작 |

---

## 마지막 단계: 자동 Git Commit

@.claude/includes/wf-auto-commit.md

---

<!--
orchay 프로젝트 - Workflow Command
author: 장종익
Command: wf:apply
Version: 1.0

Changes (v1.0):
- 생성
-->
