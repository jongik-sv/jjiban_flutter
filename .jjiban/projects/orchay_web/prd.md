# PRD: orchay_web - 웹 모니터링 UI

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서 버전 | 1.0 |
| 작성일 | 2025-12-28 |
| 상태 | Draft |
| 프로젝트 경로 | `./orchay` (기존 orchay에 추가) |

---

## 1. 제품 개요

### 1.1 목적

orchay 스케줄러에 내장 웹서버를 추가하여 브라우저에서 WBS 트리와 Task 진행 상황을 실시간으로 모니터링할 수 있게 합니다.

### 1.2 핵심 가치

| 가치 | 설명 |
|------|------|
| 접근성 | 터미널 없이 브라우저로 모니터링 |
| 시각화 | WBS 트리 구조 직관적 표현 |
| 실시간 | Worker 상태, Task 진행률 자동 갱신 |
| 간편성 | orchay 실행 시 자동으로 웹서버 시작 |

### 1.3 사용 시나리오

```bash
$ orchay jjiban --web        # 웹서버 포함 실행
$ orchay jjiban --web-only   # 웹서버만 실행 (스케줄링 없음)

# → http://localhost:8080 접속
# → WBS 트리 + Task 상세 + Worker 상태 확인
```

---

## 2. 화면 구성

### 2.1 레이아웃

```
┌─────────────────────────────────────────────────────────────┐
│  orchay - Project Monitor                    [MODE: quick]  │
├─────────────────────────────────────────────────────────────┤
│  Workers: 🟢 idle  🟡 busy  🟡 busy     Progress: ████░ 75% │
├───────────────────────────────┬─────────────────────────────┤
│  WBS Tree                     │  Task Detail                │
│  ▼ WP-08 (25%)               │  TSK-08-01                  │
│    • TSK-08-01 [bd] ←선택    │  ─────────────────────────  │
│    • TSK-08-02 [dd]          │  Status: [bd] 기본설계      │
│    • TSK-08-03 [dd]          │  Category: infra            │
│  ▶ WP-01 (0%)                │  Priority: critical         │
│  ▶ WP-02 (0%)                │  Depends: -                 │
│                              │  ─────────────────────────  │
│                              │  Documents:                 │
│                              │  - 010-design.md            │
└───────────────────────────────┴─────────────────────────────┘
```

### 2.2 주요 컴포넌트

| 컴포넌트 | 설명 |
|----------|------|
| Header | 프로젝트명, 모드 표시 |
| Worker Bar | Worker 상태 아이콘, 전체 진행률 |
| WBS Tree | 계층형 트리 (WP > ACT > TSK), 확장/축소 |
| Task Detail | 선택한 Task의 상세 정보 |

### 2.3 실시간 갱신

- **갱신 주기**: 5초 (Orchestrator interval과 동일)
- **갱신 대상**: Worker 상태, Task 상태, 진행률
- **방식**: HTMX `hx-trigger="every 5s"`

---

## 3. 기능 요구사항

### 3.1 WBS 트리

| 기능 | 설명 |
|------|------|
| 계층 표시 | Project > WP > ACT > TSK |
| 확장/축소 | 클릭으로 하위 노드 토글 |
| 상태 표시 | 상태 기호 [bd], [dd], [xx] 등 색상으로 표시 |
| 진행률 | 각 WP/ACT의 완료율 표시 |
| 선택 | Task 클릭 시 상세 패널에 표시 |

### 3.2 Task 상세 패널

| 필드 | 설명 |
|------|------|
| ID | Task 식별자 |
| Title | Task 제목 |
| Status | 현재 상태 + 라벨 |
| Category | development, defect, infrastructure |
| Priority | critical, high, medium, low |
| Depends | 의존 Task 목록 |
| Documents | 관련 문서 링크 |

### 3.3 Worker 상태 표시

| 상태 | 아이콘 | 색상 |
|------|--------|------|
| idle | 🟢 | #22c55e |
| busy | 🟡 | #f59e0b |
| paused | ⏸️ | #8b5cf6 |
| error | 🔴 | #ef4444 |
| blocked | ⊘ | #6b7280 |

### 3.4 CLI 옵션

| 옵션 | 설명 |
|------|------|
| `--web` | 웹서버 포함 실행 (기본 포트 8080) |
| `--web-only` | 웹서버만 실행 (스케줄링 비활성화) |
| `--port PORT` | 웹서버 포트 지정 |
| `--no-web` | 웹서버 비활성화 (기본 TUI만) |

### 3.5 Document Viewer

Task 상세 패널의 Documents 목록에서 문서를 클릭하면 모달 팝업으로 표시합니다.

| 기능 | 설명 |
|------|------|
| MD 렌더링 | marked.js로 마크다운 → HTML 변환 |
| Mermaid 지원 | mermaid.js로 다이어그램 렌더링 (다크 테마) |
| 이미지 표시 | png, jpg, gif, webp 지원 |
| 모달 UI | ESC 또는 X 버튼으로 닫기 |

**지원 파일 형식:**
- `.md` - 마크다운 문서 (Mermaid 코드블록 포함)
- `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp` - 이미지

**API 엔드포인트:**
- `GET /api/document/{task_id}/{doc_name}` - 문서/이미지 반환

### 3.6 UI 개선 (Vue 스타일)

#### 3.6.1 헤더 개선

| 요소 | 설명 |
|------|------|
| WBS 메뉴 배지 | 현재 페이지를 나타내는 배지 표시 |
| 프로젝트명/모드 분리 | 우측에 프로젝트명과 모드 배지 분리 배치 |

#### 3.6.2 트리 패널 개선

| 요소 | 설명 |
|------|------|
| 통계 배지 | WP/ACT/TSK 개수 및 전체 진행률 표시 |
| 검색창 | Task ID 또는 제목으로 필터링 |
| 전체 펼치기/접기 | 모든 WP 노드 일괄 토글 버튼 |

#### 3.6.3 트리 노드 인터랙션

| 동작 | 결과 |
|------|------|
| WP/ACT 텍스트 클릭 | Detail 패널에 WP/ACT 설명 표시 |
| 앞 아이콘(▶/▼) 클릭 | 트리 열기/닫기 |
| Task 텍스트 클릭 | Detail 패널에 Task 상세 표시 |

#### 3.6.4 Task Detail 패널 개선

**기본 정보 섹션:**
- Task ID를 배지 형태로 표시 (프로젝트 + 카테고리 + ID)
- 제목, 우선순위, 담당자, 태그, 참조 표시
- 이전/다음 Task 네비게이션

**진행 상태 섹션:**
- 워크플로우 스테퍼 (시작 전 → 설계 → 구현 → 완료)
- 진행률 바 표시

**요구사항 섹션:**
- PRD 참조 표시
- 요구사항 체크리스트 표시
- 접기/펼치기 기능

**기술 스펙 섹션:**
- TRD 기술 스펙 표시
- API 스펙, UI 스펙 등
- 접기/펼치기 기능

**관련 문서 섹션:**
- 테이블 형태: 문서명, 타입, 크기, 수정일
- 클릭 시 Document Viewer 모달로 표시 (3.5 참조)
- 접기/펼치기 기능

#### 3.6.5 제외 항목

| 제외 요소 | 사유 |
|----------|------|
| 대시보드/칸반/Gantt 메뉴 | 불필요 |
| "시작", "건너뛰기" 버튼 | orchestrator가 자동 관리 |
| Claude Code 실행 섹션 | TUI에서 관리 |

---

## 4. 비기능 요구사항

| 항목 | 요구사항 |
|------|----------|
| 성능 | 페이지 로드 < 1초 |
| 호환성 | Chrome, Firefox, Safari 최신 버전 |
| 반응성 | 모바일 뷰포트 지원 |
| 보안 | localhost만 접근 (기본) |

---

## 5. 제약 조건

### 5.1 기술 제약

- **빌드 도구 없음**: npm, webpack 등 별도 빌드 불필요
- **Python 단일 스택**: 모든 의존성은 pip로 설치
- **CDN 사용**: HTMX, Tailwind는 CDN으로 로드

### 5.2 통합 제약

- 기존 orchay 코드와 자연스럽게 통합
- Orchestrator 메모리 직접 참조 (추가 파일 I/O 없음)
- TUI와 웹 UI 동시 실행 가능

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-12-28 | 초기 PRD 작성 |
| 1.1 | 2025-12-28 | 3.5 Document Viewer 기능 추가 |
| 1.2 | 2025-12-28 | 3.6 UI 개선 (Vue 스타일) 추가 |
| 1.3 | 2025-12-28 | BugFix: idiomorph CDN 경로 수정 (깜빡임 해소) |
